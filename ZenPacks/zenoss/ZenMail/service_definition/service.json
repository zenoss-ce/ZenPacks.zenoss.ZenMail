{
   "servicePath": "/hub/collector",
   "serviceDefinition": {
       "Description": "Collector daemon that listens on SMTP and converts email messages into events",
       "Actions": {
           "debug": "su - zenoss -c '${ZENHOME:-/opt/zenoss}/bin/{{.Name}} debug'",
           "stats": "su - zenoss -c '${ZENHOME:-/opt/zenoss}/bin/{{.Name}} stats'"
       },
       "Command": "su - zenoss -c \"/opt/zenoss/bin/zenmail run -c --duallog --monitor {{(parent .).Name}} \"",
       "ConfigFiles": {
           "/opt/zenoss/etc/global.conf": {
               "Filename": "/opt/zenoss/etc/global.conf",
               "Owner": "zenoss:zenoss",
               "Permissions": "660",
               "Content": "# Generated by serviced\n{{range $k,$v:=contextFilter . \"global.conf.\"}}{{$k}} {{$v}}\n{{end}}"
           },
           "/opt/zenoss/etc/zenmail.conf": {
               "FileName": "/opt/zenoss/etc/zenmail.conf",
               "Owner": "zenoss:zenoss",
               "Permissions": "0664"
           }
       },
       "Endpoints": [
           {
               "Name": "zenhub",
               "Application": "{{(parent (parent .)).Name}}_zenhubPB",
               "PortNumber": 8789,
               "Protocol": "tcp",
               "Purpose": "import"
           },
           {
               "Name": "controlplane_consumer",
               "Application": "controlplane_consumer",
               "PortNumber": 8444,
               "Protocol": "tcp",
               "Purpose": "import"
           },
           {
               "Name": "zenmail_smtp",
               "Application": "zenmail_smtp",
               "PortNumber": 50025,
               "Protocol": "tcp",
               "Purpose": "export",
               "AddressConfig": {
                 "Port": 25,
                 "Protocol": "tcp"
               }
           }
       ],
       "ImageID": "",
       "Instances": {
           "default": 1,
           "max": 1
       },
       "ChangeOptions": [],
       "RAMCommitment": "1G",
       "CPUCommitment": 1,
       "Launch": "manual",
       "LogConfigs": [
           {
               "LogTags": [
                   {
                       "Name": "monitor",
                       "Value": "{{(parent .).Name}}"
                   }
               ],
               "filters": [
                   "zenmaildaemon"
               ],
               "path": "/opt/zenoss/log/zenmail.log",
               "type": "zenmail"
           },
           {
               "filters": [
                   "supervisord"
               ],
               "path": "/opt/zenoss/log/audit.log",
               "type": "zenossaudit"
           }
       ],
       "Name": "zenmail",
       "Services": [],
       "Tags": [
           "ZenPacks.zenoss.ZenMail",
           "daemon",
           "collector"
       ],
       "MonitoringProfile": {
           "MetricConfigs": [
               {
                   "ID": "zenmail",
                   "Name": "zenmail internal metrics",
                   "Description": "zenmail internal metrics",
                   "Metrics": [
                       {
                           "ID": "eventCount",
                           "Name": "Event Count",
                           "Description": "Total number of events.",
                           "Counter": true,
                           "Unit": "Events"
                       },
                       {
                           "ID": "eventQueueLength",
                           "Name": "Event Queue Length",
                           "Description": "The number of events pending to be flushed from a daemon's memory queue.",
                           "Counter": false,
                           "Unit": "Events"
                       },
                       {
                           "ID": "missedRuns",
                           "Name": "Missed Runs",
                           "Description": "Number of missed runs of tasks running on daemon.",
                           "Counter": true,
                           "Unit": "Runs"
                       },
                       {
                           "ID": "queuedTasks",
                           "Name": "Queued Tasks",
                           "Description": "Number of tasks scheduled to be run, but are not running yet.",
                           "Counter": false,
                           "Unit": "Tasks"
                       },
                       {
                           "ID": "runningTasks",
                           "Name": "Running Tasks",
                           "Description": "Number of currently running tasks.",
                           "Counter": false,
                           "Unit": "Tasks"
                       },
                       {
                           "ID": "taskCount",
                           "Name": "Task Count",
                           "Description": "Total number of tasks.",
                           "Counter": false,
                           "Unit": "Tasks"
                       }
                   ]
               }
           ],
           "GraphConfigs": [
               {
                   "id": "eventCount",
                   "name": "Event Count",
                   "footer": false,
                   "returnset": "EXACT",
                   "type": "line",
                   "yAxisLabel": "Event Count",
                   "description": "Total number of events.",
                   "range": {
                       "start": "1h-ago",
                       "end": "0s-ago"
                   },
                   "datapoints": [
                       {
                           "aggregator": "avg",
                           "fill": false,
                           "format": "%%d",
                           "id": "eventCount",
                           "legend": "Event Count",
                           "metric": "eventCount",
                           "metricSource": "zenmail",
                           "name": "Event Count",
                           "rate": true,
                           "type": "line"
                       }
                   ]
               },
               {
                   "id": "eventQueueLength",
                   "name": "Event Queue Length",
                   "footer": false,
                   "returnset": "EXACT",
                   "type": "line",
                   "yAxisLabel": "Event Queue Length",
                   "description": "The number of events pending to be flushed from a daemon's memory queue.",
                   "range": {
                       "start": "1h-ago",
                       "end": "0s-ago"
                   },
                   "datapoints": [
                       {
                           "aggregator": "avg",
                           "fill": false,
                           "format": "%%d",
                           "id": "eventQueueLength",
                           "legend": "Event Queue Length",
                           "metric": "eventQueueLength",
                           "metricSource": "zenmail",
                           "name": "Event Queue Length",
                           "rate": false,
                           "type": "line"
                       }
                   ]
               },
               {
                   "id": "missedRuns",
                   "name": "Missed Runs",
                   "footer": false,
                   "returnset": "EXACT",
                   "type": "line",
                   "yAxisLabel": "Missed Runs",
                   "description": "Number of missed runs of tasks running on daemon.",
                   "range": {
                       "start": "1h-ago",
                       "end": "0s-ago"
                   },
                   "datapoints": [
                       {
                           "aggregator": "avg",
                           "fill": false,
                           "format": "%%d",
                           "id": "missedRuns",
                           "legend": "Missed Runs",
                           "metric": "missedRuns",
                           "metricSource": "zenmail",
                           "name": "Missed Runs",
                           "rate": true,
                           "type": "line"
                       }
                   ]
               },
               {
                   "id": "tasks",
                   "name": "Tasks",
                   "footer": false,
                   "returnset": "EXACT",
                   "type": "line",
                   "yAxisLabel": "",
                   "description": "Number of queued, running, and total tasks.",
                   "range": {
                       "start": "1h-ago",
                       "end": "0s-ago"
                   },
                   "datapoints": [
                       {
                           "aggregator": "avg",
                           "fill": false,
                           "format": "%%d",
                           "id": "queuedTasks",
                           "legend": "Queued Tasks",
                           "metric": "queuedTasks",
                           "metricSource": "zenmail",
                           "name": "Queued Tasks",
                           "rate": false,
                           "type": "line"
                       },
                       {
                           "aggregator": "avg",
                           "fill": false,
                           "format": "%%d",
                           "id": "runningTasks",
                           "legend": "Running Tasks",
                           "metric": "runningTasks",
                           "metricSource": "zenmail",
                           "name": "Running Tasks",
                           "rate": false,
                           "type": "line"
                       },
                       {
                           "aggregator": "avg",
                           "fill": false,
                           "format": "%%d",
                           "id": "taskCount",
                           "legend": "Task Count",
                           "metric": "taskCount",
                           "metricSource": "zenmail",
                           "name": "Task Count",
                           "rate": false,
                           "type": "line"
                       }
                   ]
               }
           ]
       },
       "HealthChecks": {
           "zenhub_answering": {
               "Script": "/opt/zenoss/bin/healthchecks/zenhub_answering",
               "Interval": 10.0
           },
           "running": {
               "Script": "pgrep -fu zenoss zenmail.py > /dev/null",
               "Interval": 5.0
           }
       },
       "Volumes": [
           {
               "Owner": "zenoss:zenoss",
               "ResourcePath": "var-zenpacks",
               "ContainerPath": "/var/zenoss",
               "Permission": "0775"
           }
       ]
   }

}
